<!DOCTYPE html>
<html lang="pt-BR">
<head>
<link rel="manifest" href="manifest.json">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="XP Life">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#667eea">
<meta name="description" content="Transforme sua vida em um RPG! Complete tarefas, ganhe XP, suba de nÃ­vel e conquiste seus objetivos.">
<link rel="manifest" href="manifest.json">
<title>XP Life - Desafios & Treinos</title>

<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
}

body {
  background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  min-height: 100vh;
  min-height: -webkit-fill-available;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  position: relative;
  overflow-x: hidden;
  touch-action: manipulation;
}

.particle {
  position: fixed;
  width: 4px;
  height: 4px;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 50%;
  animation: float-particle 20s infinite;
  pointer-events: none;
  will-change: transform, opacity;
}

@keyframes float-particle {
  0%, 100% {
    transform: translateY(0) translateX(0);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  100% {
    transform: translateY(-100vh) translateX(50px);
    opacity: 0;
  }
}

/* ========================================
   CONFETES - NOVO!
======================================== */
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  pointer-events: none;
  z-index: 9999;
  will-change: transform, opacity;
}

@keyframes confetti-fall {
  0% {
    transform: translateY(0) rotateZ(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(100vh) rotateZ(720deg);
    opacity: 0;
  }
}

/* ========================================
   NOTIFICAÃ‡ÃƒO ELEGANTE - MELHORADA!
======================================== */
#notification {
  position: fixed;
  top: -100px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.98), rgba(118, 75, 162, 0.98));
  color: white;
  padding: 18px 28px;
  border-radius: 16px;
  font-weight: 600;
  font-size: 16px;
  z-index: 10000;
  box-shadow: 
    0 20px 60px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  min-width: 200px;
  text-align: center;
}

#notification.show {
  top: 30px;
  animation: notification-bounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@keyframes notification-bounce {
  0% { transform: translateX(-50%) translateY(-20px) scale(0.8); opacity: 0; }
  50% { transform: translateX(-50%) translateY(5px) scale(1.05); }
  100% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
}

#notification.success {
  background: linear-gradient(135deg, rgba(46, 204, 113, 0.98), rgba(39, 174, 96, 0.98));
}

#notification.warning {
  background: linear-gradient(135deg, rgba(241, 196, 15, 0.98), rgba(243, 156, 18, 0.98));
}

#notification.error {
  background: linear-gradient(135deg, rgba(231, 76, 60, 0.98), rgba(192, 57, 43, 0.98));
}

/* ========================================
   CONTAINER PRINCIPAL - TRANSIÃ‡Ã•ES MELHORADAS
======================================== */
#game {
  max-width: 500px;
  width: 100%;
  background: rgba(20, 20, 35, 0.95);
  border-radius: 25px;
  padding: 30px;
  box-shadow: 
    0 25px 70px rgba(0, 0, 0, 0.6),
    0 0 0 1px rgba(255, 255, 255, 0.1);
  position: relative;
  z-index: 1;
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

/* TRANSIÃ‡Ã•ES SUAVES ENTRE TELAS - NOVO! */
.screen {
  animation: screenFadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes screenFadeIn {
  0% {
    opacity: 0;
    transform: translateY(20px) scale(0.98);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.screen.fade-out {
  animation: screenFadeOut 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes screenFadeOut {
  0% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  100% {
    opacity: 0;
    transform: translateY(-20px) scale(0.98);
  }
}

h1 {
  font-size: 32px;
  margin-bottom: 10px;
  text-align: center;
  background: linear-gradient(45deg, #ff6b6b, #ffd93d, #4ecdc4, #a78bfa);
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradient-shift 3s ease infinite;
}

@keyframes gradient-shift {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

h2 {
  font-size: 24px;
  margin-bottom: 20px;
  text-align: center;
  color: #ffd93d;
}

h3 {
  font-size: 18px;
  margin: 25px 0 12px 0;
  color: #a78bfa;
  display: flex;
  align-items: center;
  gap: 10px;
}

h3::before {
  content: '';
  flex: 1;
  height: 2px;
  background: linear-gradient(90deg, transparent, #a78bfa);
}

h3::after {
  content: '';
  flex: 1;
  height: 2px;
  background: linear-gradient(90deg, #a78bfa, transparent);
}

/* ========================================
   BOTÃ•ES COM FEEDBACK MELHORADO
======================================== */
button {
  width: 100%;
  padding: 15px;
  margin: 8px 0;
  font-size: 16px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-weight: 600;
  box-shadow: 
    0 6px 20px rgba(102, 126, 234, 0.4),
    inset 0 -2px 0 rgba(0, 0, 0, 0.2);
  position: relative;
  overflow: hidden;
  -webkit-appearance: none;
  touch-action: manipulation;
  will-change: transform;
}

button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  transition: left 0.5s;
}

button:active {
  transform: scale(0.98) translateY(2px);
  box-shadow: 
    0 3px 10px rgba(102, 126, 234, 0.4),
    inset 0 -2px 0 rgba(0, 0, 0, 0.2);
}

button:active::before {
  left: 100%;
}

button.primary-btn {
  background: linear-gradient(135deg, #ff6b6b 0%, #ffd93d 100%);
  box-shadow: 0 8px 25px rgba(255, 107, 107, 0.5);
  font-size: 18px;
  padding: 18px;
  animation: pulse-glow 2s ease-in-out infinite;
}

@keyframes pulse-glow {
  0%, 100% {
    box-shadow: 0 8px 25px rgba(255, 107, 107, 0.5);
  }
  50% {
    box-shadow: 0 8px 35px rgba(255, 217, 61, 0.8);
  }
}

button.completed {
  background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
  cursor: not-allowed;
  opacity: 0.8;
  box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
}

button.back-btn {
  background: linear-gradient(135deg, #555 0%, #333 100%);
  margin-bottom: 20px;
}

button.gender-btn {
  width: 48%;
  display: inline-block;
  margin: 10px 1%;
  padding: 80px 20px 20px 20px;
  font-size: 18px;
  position: relative;
}

button.gender-btn .emoji {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 60px;
  transition: transform 0.3s ease;
}

button.gender-btn:active .emoji {
  transform: translateX(-50%) scale(1.2);
}

button.gender-btn.male {
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
}

button.gender-btn.female {
  background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);
  box-shadow: 0 6px 20px rgba(233, 30, 99, 0.4);
}

button.daily-challenge-btn {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  box-shadow: 0 8px 25px rgba(240, 147, 251, 0.5);
  animation: pulse-challenge 3s ease-in-out infinite;
}

@keyframes pulse-challenge {
  0%, 100% {
    box-shadow: 0 8px 25px rgba(240, 147, 251, 0.5);
    transform: scale(1);
  }
  50% {
    box-shadow: 0 12px 35px rgba(245, 87, 108, 0.8);
    transform: scale(1.02);
  }
}

.section {
  margin-top: 20px;
  padding-top: 15px;
}

.hidden { 
  display: none !important;
}

/* ========================================
   PLAYER COM ANIMAÃ‡Ã•ES MELHORADAS
======================================== */
#playerContainer {
  text-align: center;
  margin: 30px 0;
}

#player {
  font-size: 140px;
  display: inline-block;
  animation: float3d 4s ease-in-out infinite;
  filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.5));
  transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  will-change: transform, filter;
}

@keyframes float3d {
  0%, 100% { 
    transform: translateY(0) scale(1);
  }
  25% {
    transform: translateY(-15px) scale(1.05);
  }
  50% { 
    transform: translateY(-5px) scale(1);
  }
  75% {
    transform: translateY(-15px) scale(1.05);
  }
}

/* CONFETES AO SUBIR DE NÃVEL - NOVO! */
.player-pulse {
  animation: megaPulse 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
}

@keyframes megaPulse {
  0%, 100% { 
    transform: scale(1) rotate(0deg);
    filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.5));
  }
  25% {
    transform: scale(1.4) rotate(-5deg);
    filter: drop-shadow(0 20px 50px rgba(255, 215, 0, 0.9));
  }
  50% { 
    transform: scale(1.3) rotate(5deg);
    filter: drop-shadow(0 25px 60px rgba(255, 107, 107, 0.9));
  }
  75% {
    transform: scale(1.4) rotate(-5deg);
    filter: drop-shadow(0 20px 50px rgba(167, 139, 250, 0.9));
  }
}

.level-badge {
  display: inline-block;
  background: linear-gradient(135deg, #ffd93d 0%, #ff6b6b 100%);
  color: #000;
  padding: 8px 20px;
  border-radius: 30px;
  font-weight: bold;
  font-size: 18px;
  margin-top: 15px;
  box-shadow: 0 5px 15px rgba(255, 217, 61, 0.5);
  animation: glow 2s ease-in-out infinite;
  transition: transform 0.3s ease;
}

.level-badge.level-up {
  animation: levelUpBadge 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@keyframes levelUpBadge {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.3) rotate(5deg); }
}

@keyframes glow {
  0%, 100% {
    box-shadow: 0 5px 15px rgba(255, 217, 61, 0.5);
  }
  50% {
    box-shadow: 0 5px 30px rgba(255, 217, 61, 0.9);
  }
}

/* ========================================
   PROGRESS BARS ANIMADAS - NOVO!
======================================== */
.progress-container {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 20px;
  height: 24px;
  overflow: hidden;
  position: relative;
  margin: 15px 0;
  border: 2px solid rgba(255, 255, 255, 0.1);
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
}

.progress-bar {
  height: 100%;
  background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
  background-size: 200% 100%;
  border-radius: 18px;
  transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  animation: shimmer 2s infinite;
  box-shadow: 
    0 0 20px rgba(102, 126, 234, 0.5),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

@keyframes shimmer {
  0% { background-position: 0% 50%; }
  100% { background-position: 200% 50%; }
}

.progress-bar::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.3),
    transparent
  );
  animation: progress-shine 2s infinite;
}

@keyframes progress-shine {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.progress-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-weight: bold;
  font-size: 13px;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
  z-index: 1;
  color: white;
}

.stats {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
  border-radius: 15px;
  padding: 20px;
  margin: 20px 0;
  border: 2px solid rgba(167, 139, 250, 0.3);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.stat-row {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s ease;
}

.stat-row:hover {
  background: rgba(255, 255, 255, 0.05);
  padding-left: 10px;
  border-radius: 8px;
}

.stat-row:last-child {
  border-bottom: none;
}

.stat-row strong {
  color: #a78bfa;
}

.stat-row span {
  color: #ffd93d;
  font-weight: 600;
}

#xpProgress {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  height: 30px;
  margin: 15px 0;
  overflow: hidden;
  position: relative;
  border: 2px solid rgba(167, 139, 250, 0.3);
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
}

#xpBar {
  height: 100%;
  background: linear-gradient(90deg, #ffd93d 0%, #ff6b6b 100%);
  transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 18px;
  position: relative;
  box-shadow: 0 0 20px rgba(255, 217, 61, 0.6);
  animation: xp-pulse 2s ease-in-out infinite;
}

@keyframes xp-pulse {
  0%, 100% {
    box-shadow: 0 0 20px rgba(255, 217, 61, 0.6);
  }
  50% {
    box-shadow: 0 0 30px rgba(255, 107, 107, 0.8);
  }
}

#xpText {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-weight: bold;
  font-size: 14px;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
  z-index: 1;
}

.task-row {
  display: flex;
  align-items: center;
  padding: 12px;
  margin: 8px 0;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  border-left: 4px solid #a78bfa;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.task-row:hover {
  background: rgba(255, 255, 255, 0.08);
  transform: translateX(5px);
}

.task-row.completed {
  opacity: 0.6;
  border-left-color: #2ecc71;
}

.task-checkbox {
  width: 24px;
  height: 24px;
  border: 2px solid #a78bfa;
  border-radius: 6px;
  margin-right: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  flex-shrink: 0;
}

.task-checkbox.checked {
  background: #2ecc71;
  border-color: #2ecc71;
}

.task-checkbox.checked::after {
  content: 'âœ“';
  color: white;
  font-weight: bold;
  font-size: 16px;
}

.task-info {
  flex: 1;
}

.task-name {
  font-weight: 600;
  color: #fff;
  margin-bottom: 4px;
}

.task-streak {
  font-size: 12px;
  color: #ffd93d;
}

.task-xp {
  background: linear-gradient(135deg, #667eea, #764ba2);
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: bold;
  color: white;
  white-space: nowrap;
}

.badges-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.badge {
  background: linear-gradient(135deg, rgba(167, 139, 250, 0.2), rgba(102, 126, 234, 0.2));
  border: 2px solid rgba(167, 139, 250, 0.5);
  border-radius: 15px;
  padding: 20px 15px;
  text-align: center;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.badge:hover {
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 10px 30px rgba(167, 139, 250, 0.4);
  border-color: rgba(167, 139, 250, 0.8);
}

.badge.locked {
  opacity: 0.4;
  filter: grayscale(1);
}

.badge.locked:hover {
  transform: none;
  box-shadow: none;
}

/* Treinos */
.workout-item {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
  border: 2px solid rgba(167, 139, 250, 0.3);
  border-radius: 12px;
  padding: 20px;
  margin: 12px 0;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.workout-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: left 0.5s;
}

.workout-item:hover::before {
  left: 100%;
}

.workout-item:active {
  transform: scale(0.98);
}

.workout-item.completed {
  background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(39, 174, 96, 0.2));
  border-color: rgba(46, 204, 113, 0.5);
}

.workout-item.completed::after {
  content: 'âœ“';
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 28px;
  color: #2ecc71;
  font-weight: bold;
}

.workout-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 8px;
}

.workout-icon {
  font-size: 32px;
}

.workout-title {
  font-weight: 600;
  font-size: 18px;
}

.workout-desc {
  color: rgba(255, 255, 255, 0.7);
  font-size: 14px;
  margin-left: 44px;
}

/* HidrataÃ§Ã£o */
.water-buttons {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin: 20px 0;
}

.water-btn {
  background: linear-gradient(135deg, #4ecdc4 0%, #44a3a0 100%);
  padding: 20px 10px;
  border-radius: 12px;
  border: none;
  color: white;
  font-weight: bold;
  font-size: 18px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
  position: relative;
  overflow: hidden;
}

.water-btn::before {
  content: 'ğŸ’§';
  position: absolute;
  top: 5px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 24px;
}

.water-btn:active {
  transform: scale(0.95) translateY(2px);
  box-shadow: 0 3px 10px rgba(78, 205, 196, 0.4);
}

.water-goal-input {
  display: flex;
  gap: 10px;
  margin-top: 15px;
  align-items: center;
}

.water-goal-input input {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  border: 2px solid rgba(167, 139, 250, 0.3);
  background: rgba(255, 255, 255, 0.1);
  color: white;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.water-goal-input input:focus {
  outline: none;
  border-color: #4ecdc4;
  box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
}

.water-goal-input button {
  width: auto;
  padding: 12px 24px;
  margin: 0;
}

/* HistÃ³rico */
.history-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 10px;
  margin-top: 20px;
}

.history-day {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(167, 139, 250, 0.2);
  border-radius: 12px;
  padding: 15px 10px;
  text-align: center;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.history-day:hover {
  transform: translateY(-3px);
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(167, 139, 250, 0.5);
}

.history-day.active {
  background: linear-gradient(135deg, rgba(255, 217, 61, 0.2), rgba(255, 107, 107, 0.2));
  border-color: rgba(255, 217, 61, 0.6);
}

.history-date {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.6);
  margin-bottom: 5px;
}

.history-xp {
  font-weight: bold;
  color: #ffd93d;
  font-size: 16px;
}

.history-tasks {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.7);
  margin-top: 3px;
}

/* Responsividade */
@media (max-width: 480px) {
  #game {
    padding: 20px;
    border-radius: 20px;
  }
  
  h1 {
    font-size: 28px;
  }
  
  #player {
    font-size: 100px;
  }
  
  .badges-grid {
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  }
  
  .water-buttons {
    grid-template-columns: repeat(2, 1fr);
  }
}
</style>
</head>
<body>

<div id="notification"></div>

<div id="game">
  <!-- SETUP -->
  <div id="setup" class="screen hidden">
    <h1>ğŸ® XP Life</h1>
    <h2>Escolha seu personagem</h2>
    <button class="gender-btn male" onclick="selectGender('male')">
      <span class="emoji">ğŸ‘¨</span>
      Masculino
    </button>
    <button class="gender-btn female" onclick="selectGender('female')">
      <span class="emoji">ğŸ‘©</span>
      Feminino
    </button>
  </div>

  <!-- MENU PRINCIPAL -->
  <div id="menu" class="screen hidden">
    <h1>ğŸ® XP Life</h1>
    
    <div id="playerContainer">
      <div id="player">ğŸ§‘</div>
      <div class="level-badge" id="levelBadge">Level 1</div>
    </div>

    <div id="xpProgress">
      <div id="xpBar" style="width: 0%"></div>
      <div id="xpText">0 / 100 XP</div>
    </div>

    <div class="stats">
      <div class="stat-row">
        <strong>ğŸ”¥ Streak Atual</strong>
        <span id="currentStreak">0 dias</span>
      </div>
      <div class="stat-row">
        <strong>â­ XP Total</strong>
        <span id="totalXP">0</span>
      </div>
      <div class="stat-row">
        <strong>âœ… Tarefas Hoje</strong>
        <span id="tasksToday">0</span>
      </div>
    </div>

    <button class="primary-btn" onclick="openScreen('tasks')">ğŸ“‹ Tarefas</button>
    <button class="daily-challenge-btn" onclick="openScreen('dailyChallenge')">ğŸ² Desafio DiÃ¡rio</button>
    <button onclick="openScreen('workouts')">ğŸ’ª Treinos</button>
    <button onclick="openScreen('water')">ğŸ’§ HidrataÃ§Ã£o</button>
    <button onclick="openScreen('achievements')">ğŸ† Conquistas</button>
    <button onclick="openScreen('ranking')">ğŸ“Š Ranking</button>
    <button onclick="openScreen('history')">ğŸ“… HistÃ³rico</button>
    <button id="soundToggle" onclick="toggleSound()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">ğŸ”Š Som: ON</button>
    <button class="back-btn" onclick="resetProgress()">ğŸ”„ Resetar Progresso</button>
  </div>

  <!-- TAREFAS -->
  <div id="tasks" class="screen hidden">
    <button class="back-btn" onclick="openScreen('menu')">â† Voltar</button>
    <h2>ğŸ“‹ Tarefas DiÃ¡rias</h2>
    
    <div id="tasksList"></div>
  </div>

  <!-- DESAFIO DIÃRIO -->
  <div id="dailyChallenge" class="screen hidden">
    <button class="back-btn" onclick="openScreen('menu')">â† Voltar</button>
    <h2>ğŸ² Desafios DiÃ¡rios</h2>
    
    <div class="stats" style="margin-bottom: 20px;">
      <div class="stat-row">
        <strong>ğŸ¯ Desafios Hoje</strong>
        <span id="todayChallengesCount">0/3</span>
      </div>
    </div>

    <h3>âš¡ Desafios de Hoje</h3>

    <!-- Desafio 1 -->
    <div style="background: linear-gradient(135deg, rgba(240, 147, 251, 0.2), rgba(245, 87, 108, 0.2)); border: 2px solid rgba(240, 147, 251, 0.5); border-radius: 15px; padding: 20px; margin: 15px 0; text-align: center;" id="challenge1-card">
      <div style="font-size: 36px; margin-bottom: 10px;">ğŸ¯</div>
      <div style="background: rgba(255,255,255,0.1); padding: 8px; border-radius: 8px; margin-bottom: 12px;">
        <div style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 3px;" id="challenge1Category">Categoria</div>
        <div style="font-size: 11px; color: rgba(255,255,255,0.6);" id="challenge1Difficulty">Dificuldade</div>
      </div>
      <p id="challenge1Description" style="font-size: 16px; line-height: 1.5; margin-bottom: 15px;"></p>
      <button id="challenge1Btn" class="primary-btn" onclick="completeDailyChallenge(0)" style="font-size: 14px; padding: 12px 24px;">Completar (+100 XP)</button>
    </div>

    <!-- Desafio 2 -->
    <div style="background: linear-gradient(135deg, rgba(147, 197, 253, 0.2), rgba(59, 130, 246, 0.2)); border: 2px solid rgba(59, 130, 246, 0.5); border-radius: 15px; padding: 20px; margin: 15px 0; text-align: center;" id="challenge2-card">
      <div style="font-size: 36px; margin-bottom: 10px;">ğŸ¯</div>
      <div style="background: rgba(255,255,255,0.1); padding: 8px; border-radius: 8px; margin-bottom: 12px;">
        <div style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 3px;" id="challenge2Category">Categoria</div>
        <div style="font-size: 11px; color: rgba(255,255,255,0.6);" id="challenge2Difficulty">Dificuldade</div>
      </div>
      <p id="challenge2Description" style="font-size: 16px; line-height: 1.5; margin-bottom: 15px;"></p>
      <button id="challenge2Btn" class="primary-btn" onclick="completeDailyChallenge(1)" style="font-size: 14px; padding: 12px 24px;">Completar (+100 XP)</button>
    </div>

    <!-- Desafio 3 -->
    <div style="background: linear-gradient(135deg, rgba(167, 243, 208, 0.2), rgba(52, 211, 153, 0.2)); border: 2px solid rgba(52, 211, 153, 0.5); border-radius: 15px; padding: 20px; margin: 15px 0; text-align: center;" id="challenge3-card">
      <div style="font-size: 36px; margin-bottom: 10px;">ğŸ¯</div>
      <div style="background: rgba(255,255,255,0.1); padding: 8px; border-radius: 8px; margin-bottom: 12px;">
        <div style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 3px;" id="challenge3Category">Categoria</div>
        <div style="font-size: 11px; color: rgba(255,255,255,0.6);" id="challenge3Difficulty">Dificuldade</div>
      </div>
      <p id="challenge3Description" style="font-size: 16px; line-height: 1.5; margin-bottom: 15px;"></p>
      <button id="challenge3Btn" class="primary-btn" onclick="completeDailyChallenge(2)" style="font-size: 14px; padding: 12px 24px;">Completar (+100 XP)</button>
    </div>
    
    <div class="stats">
      <div class="stat-row">
        <strong>ğŸ† Total Completados</strong>
        <span id="totalChallenges">0</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ”¥ Streak Atual</strong>
        <span id="currentChallengeStreak">0 dias</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ’ª Melhor Streak</strong>
        <span id="challengeStreak">0 dias</span>
      </div>
      <div class="stat-row">
        <strong>â­ Taxa de ConclusÃ£o</strong>
        <span id="challengeCompletionRate">0%</span>
      </div>
    </div>

    <h3>ğŸ“Š Desafios por Categoria</h3>
    <div class="stats">
      <div class="stat-row">
        <strong>ğŸ‹ï¸ Fitness</strong>
        <span id="challengesFitness">0</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ§  Mental</strong>
        <span id="challengesMental">0</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ’š SaÃºde</strong>
        <span id="challengesHealth">0</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ¨ Criativo</strong>
        <span id="challengesCreative">0</span>
      </div>
      <div class="stat-row">
        <strong>ğŸŒŸ Bem-estar</strong>
        <span id="challengesWellness">0</span>
      </div>
    </div>
  </div>

  <!-- TREINOS -->
  <div id="workouts" class="screen hidden">
    <button class="back-btn" onclick="openScreen('menu')">â† Voltar</button>
    <h2>ğŸ’ª Registro de Treinos</h2>
    
    <div class="stats">
      <div class="stat-row">
        <strong>ğŸ“Š Treinos Hoje</strong>
        <span id="workoutsToday">0/10</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ”¥ Streak de Treinos</strong>
        <span id="workoutStreak">0 dias</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ’¯ Total de Treinos</strong>
        <span id="totalWorkouts">0</span>
      </div>
    </div>

    <h3>â° HorÃ¡rio do Treino</h3>
    
    <div class="workout-item" id="workout-morning" onclick="toggleWorkout('morning')">
      <div class="workout-header">
        <span class="workout-icon">ğŸŒ…</span>
        <span class="workout-title">ManhÃ£</span>
      </div>
      <div class="workout-desc">Treino matinal (+30 XP)</div>
    </div>

    <div class="workout-item" id="workout-afternoon" onclick="toggleWorkout('afternoon')">
      <div class="workout-header">
        <span class="workout-icon">â˜€ï¸</span>
        <span class="workout-title">Tarde</span>
      </div>
      <div class="workout-desc">Treino vespertino (+30 XP)</div>
    </div>

    <div class="workout-item" id="workout-evening" onclick="toggleWorkout('evening')">
      <div class="workout-header">
        <span class="workout-icon">ğŸŒ™</span>
        <span class="workout-title">Noite</span>
      </div>
      <div class="workout-desc">Treino noturno (+30 XP)</div>
    </div>

    <h3>ğŸ‹ï¸ Tipo de Treino</h3>
    
    <div class="workout-item" id="workout-cardio" onclick="toggleWorkout('cardio')">
      <div class="workout-header">
        <span class="workout-icon">ğŸƒ</span>
        <span class="workout-title">Cardio</span>
      </div>
      <div class="workout-desc">Corrida, bike, pular corda (+35 XP)</div>
    </div>

    <div class="workout-item" id="workout-strength" onclick="toggleWorkout('strength')">
      <div class="workout-header">
        <span class="workout-icon">ğŸ‹ï¸</span>
        <span class="workout-title">MusculaÃ§Ã£o</span>
      </div>
      <div class="workout-desc">Treino de forÃ§a e hipertrofia (+40 XP)</div>
    </div>

    <div class="workout-item" id="workout-bodyweight" onclick="toggleWorkout('bodyweight')">
      <div class="workout-header">
        <span class="workout-icon">ğŸ’ª</span>
        <span class="workout-title">Calistenia</span>
      </div>
      <div class="workout-desc">FlexÃµes, abdominais, barras (+35 XP)</div>
    </div>

    <div class="workout-item" id="workout-yoga" onclick="toggleWorkout('yoga')">
      <div class="workout-header">
        <span class="workout-icon">ğŸ§˜</span>
        <span class="workout-title">Yoga/Pilates</span>
      </div>
      <div class="workout-desc">Flexibilidade e equilÃ­brio (+30 XP)</div>
    </div>

    <div class="workout-item" id="workout-sports" onclick="toggleWorkout('sports')">
      <div class="workout-header">
        <span class="workout-icon">âš½</span>
        <span class="workout-title">Esportes</span>
      </div>
      <div class="workout-desc">Futebol, basquete, vÃ´lei, etc (+35 XP)</div>
    </div>

    <div class="workout-item" id="workout-stretching" onclick="toggleWorkout('stretching')">
      <div class="workout-header">
        <span class="workout-icon">ğŸ¤¸</span>
        <span class="workout-title">Alongamento</span>
      </div>
      <div class="workout-desc">Mobilidade e recuperaÃ§Ã£o (+20 XP)</div>
    </div>

    <div class="workout-item" id="workout-swimming" onclick="toggleWorkout('swimming')">
      <div class="workout-header">
        <span class="workout-icon">ğŸŠ</span>
        <span class="workout-title">NataÃ§Ã£o</span>
      </div>
      <div class="workout-desc">Treino completo na Ã¡gua (+40 XP)</div>
    </div>
  </div>

  <!-- HIDRATAÃ‡ÃƒO -->
  <div id="water" class="screen hidden">
    <button class="back-btn" onclick="openScreen('menu')">â† Voltar</button>
    <h2>ğŸ’§ HidrataÃ§Ã£o</h2>
    
    <div class="stats">
      <div class="stat-row">
        <strong>ğŸ’§ Hoje</strong>
        <span><span id="waterToday">0</span>ml / <span id="waterGoalDisplay">2400</span>ml</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ“Š Progresso</strong>
        <span id="waterProgress">0%</span>
      </div>
    </div>

    <div class="progress-container">
      <div class="progress-bar" id="waterProgressBar" style="width: 0%"></div>
      <div class="progress-text" id="waterProgressText">0%</div>
    </div>

    <h3>Adicionar Ãgua</h3>
    <div class="water-buttons">
      <button class="water-btn" onclick="addWater(200)" style="padding-top: 35px;">200ml</button>
      <button class="water-btn" onclick="addWater(300)" style="padding-top: 35px;">300ml</button>
      <button class="water-btn" onclick="addWater(500)" style="padding-top: 35px;">500ml</button>
    </div>

    <h3>Meta DiÃ¡ria</h3>
    <div class="water-goal-input">
      <input type="number" id="waterGoalInput" min="500" max="5000" step="100" placeholder="Meta em ml">
      <button onclick="updateWaterGoal()">Atualizar</button>
    </div>

    <div class="stats" style="margin-top: 25px;">
      <div class="stat-row">
        <strong>ğŸ”¥ Streak Atual</strong>
        <span id="waterStreakDisplay">0 dias</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ† Melhor Streak</strong>
        <span id="waterBestStreakDisplay">0 dias</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ“… Dias Completados</strong>
        <span id="waterDaysDisplay">0</span>
      </div>
      <div class="stat-row">
        <strong>ğŸŒŠ Total Bebido</strong>
        <span id="waterTotalDisplay">0 L</span>
      </div>
    </div>
  </div>

  <!-- CONQUISTAS -->
  <div id="achievements" class="screen hidden">
    <button class="back-btn" onclick="openScreen('menu')">â† Voltar</button>
    <h2>ğŸ† Conquistas</h2>
    <div id="achievementsList" class="badges-grid"></div>
  </div>

  <!-- RANKING -->
  <div id="ranking" class="screen hidden">
    <button class="back-btn" onclick="openScreen('menu')">â† Voltar</button>
    <h2>ğŸ“Š EstatÃ­sticas</h2>
    
    <div class="stats">
      <div class="stat-row">
        <strong>â­ XP Total</strong>
        <span id="totalXPRank">0</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ”¥ Melhor Streak</strong>
        <span id="bestStreakDisplay">0 dias</span>
      </div>
      <div class="stat-row">
        <strong>âœ… Total de Tarefas</strong>
        <span id="totalTasksDisplay">0</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ“… Dias Jogados</strong>
        <span id="daysPlayedDisplay">0</span>
      </div>
      <div class="stat-row">
        <strong>ğŸ¯ NÃ­vel MÃ¡ximo</strong>
        <span id="maxLevelDisplay">1</span>
      </div>
    </div>
  </div>

  <!-- HISTÃ“RICO -->
  <div id="history" class="screen hidden">
    <button class="back-btn" onclick="openScreen('menu')">â† Voltar</button>
    <h2>ğŸ“… Ãšltimos 30 Dias</h2>
    <div id="historyGrid" class="history-grid"></div>
  </div>
</div>

<script>
// ======================
// VARIÃVEIS GLOBAIS
// ======================
let player = {
  gender: null,
  level: 1,
  xp: 0,
  totalXP: 0,
  currentStreak: 0,
  bestStreak: 0,
  tasksToday: 0,
  totalTasks: 0,
  daysPlayed: 0,
  maxLevel: 1,
  lastDate: null,
  achievements: [],
  taskStreaks: {},
  taskHistory: {},
  completedToday: [],
  workoutCompleted: {},
  totalWorkouts: 0,
  dailyChallengesCompleted: [false, false, false],
  challengesByCategory: {
    fitness: 0,
    mental: 0,
    health: 0,
    creative: 0,
    wellness: 0
  },
  waterToday: 0,
  waterGoal: 2400,
  waterStreak: 0,
  waterBestStreak: 0,
  waterDaysCompleted: 0,
  waterTotalDrunk: 0,
  waterHistory: [],
  history: []
};

const playerEmojis = {
  male: ["ğŸ‘¨", "ğŸ‘¨â€ğŸ’¼", "ğŸ‘¨â€ğŸ“", "ğŸ‘¨â€ğŸ«", "ğŸ‘¨â€âš•ï¸", "ğŸ‘¨â€ğŸš€", "ğŸ‘¨â€ğŸ¨", "ğŸ§™â€â™‚ï¸", "ğŸ¦¸â€â™‚ï¸", "ğŸ¥·"],
  female: ["ğŸ‘©", "ğŸ‘©â€ğŸ’¼", "ğŸ‘©â€ğŸ“", "ğŸ‘©â€ğŸ«", "ğŸ‘©â€âš•ï¸", "ğŸ‘©â€ğŸš€", "ğŸ‘©â€ğŸ¨", "ğŸ§™â€â™€ï¸", "ğŸ¦¸â€â™€ï¸", "ğŸ¥·"]
};

const tasksList = [
  // MANHÃƒ
  { id: 'acordar_cedo', name: 'Acordar Cedo (antes das 7h)', xp: 20, category: 'ManhÃ£' },
  { id: 'cafe', name: 'CafÃ© da ManhÃ£ SaudÃ¡vel', xp: 15, category: 'ManhÃ£' },
  { id: 'cama', name: 'Arrumar a Cama', xp: 10, category: 'ManhÃ£' },
  
  // ESTUDO/TRABALHO
  { id: 'estudo_1h', name: 'Estudar 1 hora', xp: 30, category: 'Estudo/Trabalho' },
  { id: 'trabalho_foco', name: 'Trabalhar com foco (2h)', xp: 40, category: 'Estudo/Trabalho' },
  { id: 'leitura', name: 'Ler 30 minutos', xp: 25, category: 'Estudo/Trabalho' },
  
  // SAÃšDE
  { id: 'exercicio', name: 'Fazer ExercÃ­cio (30 min)', xp: 35, category: 'SaÃºde' },
  { id: 'alongamento', name: 'Alongamento', xp: 15, category: 'SaÃºde' },
  { id: 'agua', name: 'Beber 2L de Ãgua', xp: 20, category: 'SaÃºde' },
  { id: 'frutas', name: 'Comer 3 Frutas', xp: 20, category: 'SaÃºde' },
  { id: 'vegetais', name: 'Comer Salada/Vegetais', xp: 20, category: 'SaÃºde' },
  { id: 'suplementos', name: 'Tomar Vitaminas/Suplementos', xp: 15, category: 'SaÃºde' },
  { id: 'postura', name: 'Manter Boa Postura', xp: 15, category: 'SaÃºde' },
  { id: 'caminhada', name: 'Caminhar 30 minutos', xp: 25, category: 'SaÃºde' },
  { id: 'evitar_fastfood', name: 'Zero Fast Food/Frituras', xp: 25, category: 'SaÃºde' },
  { id: 'proteina', name: 'Consumir ProteÃ­na Adequada', xp: 20, category: 'SaÃºde' },
  
  // AUTOCUIDADO
  { id: 'meditacao', name: 'Meditar 10 minutos', xp: 25, category: 'Autocuidado' },
  { id: 'sem_redes', name: 'Sem Redes Sociais (3h)', xp: 30, category: 'Autocuidado' },
  { id: 'dormir_cedo', name: 'Dormir antes das 23h', xp: 25, category: 'Autocuidado' },
  { id: 'banho_frio', name: 'Banho Frio', xp: 20, category: 'Autocuidado' }
];

const achievementsList = [
  { id: 'first_task', name: 'Primeira Tarefa', desc: 'Complete sua primeira tarefa', icon: 'ğŸ¯' },
  { id: 'streak_7', name: 'Uma Semana', desc: '7 dias consecutivos', icon: 'ğŸ”¥' },
  { id: 'streak_30', name: 'Um MÃªs', desc: '30 dias consecutivos', icon: 'ğŸ’ª' },
  { id: 'level_5', name: 'NÃ­vel 5', desc: 'Alcance o nÃ­vel 5', icon: 'â­' },
  { id: 'level_10', name: 'NÃ­vel 10', desc: 'Alcance o nÃ­vel 10', icon: 'ğŸŒŸ' },
  { id: 'tasks_100', name: 'CentenÃ¡rio', desc: 'Complete 100 tarefas', icon: 'ğŸ’¯' },
  { id: 'tasks_500', name: 'Dedicado', desc: 'Complete 500 tarefas', icon: 'ğŸ†' },
  { id: 'early_bird', name: 'Madrugador', desc: 'Acorde cedo 10 vezes', icon: 'ğŸŒ…' },
  { id: 'gym_rat', name: 'Fitness', desc: 'Exercite-se 20 vezes', icon: 'ğŸ’ª' },
  { id: 'bookworm', name: 'Leitor', desc: 'Leia 15 vezes', icon: 'ğŸ“š' },
  { id: 'hydrated', name: 'Hidratado', desc: 'Meta de Ã¡gua 10 dias', icon: 'ğŸ’§' },
  { id: 'zen_master', name: 'Zen Master', desc: 'Medite 15 vezes', icon: 'ğŸ§˜' }
];

const dailyChallenges = [
  // FITNESS
  { text: "FaÃ§a 50 flexÃµes", category: "ğŸ‹ï¸ Fitness", difficulty: "â­ MÃ©dio" },
  { text: "FaÃ§a 100 agachamentos", category: "ğŸ‹ï¸ Fitness", difficulty: "â­â­ DifÃ­cil" },
  { text: "FaÃ§a 30 burpees", category: "ğŸ‹ï¸ Fitness", difficulty: "â­â­ DifÃ­cil" },
  { text: "Corra 5km", category: "ğŸ‹ï¸ Fitness", difficulty: "â­â­â­ Muito DifÃ­cil" },
  { text: "FaÃ§a 200 abdominais", category: "ğŸ‹ï¸ Fitness", difficulty: "â­â­â­ Muito DifÃ­cil" },
  { text: "Prancha por 3 minutos", category: "ğŸ‹ï¸ Fitness", difficulty: "â­â­ DifÃ­cil" },
  { text: "FaÃ§a 20 pull-ups", category: "ğŸ‹ï¸ Fitness", difficulty: "â­â­â­ Muito DifÃ­cil" },
  { text: "Caminhe 10.000 passos", category: "ğŸ‹ï¸ Fitness", difficulty: "â­ MÃ©dio" },
  { text: "FaÃ§a 100 jumping jacks", category: "ğŸ‹ï¸ Fitness", difficulty: "â­ MÃ©dio" },
  { text: "Treino de 45 minutos", category: "ğŸ‹ï¸ Fitness", difficulty: "â­â­ DifÃ­cil" },
  
  // MENTAL
  { text: "Leia 20 pÃ¡ginas de um livro", category: "ğŸ§  Mental", difficulty: "â­ MÃ©dio" },
  { text: "Aprenda 10 palavras em outro idioma", category: "ğŸ§  Mental", difficulty: "â­ MÃ©dio" },
  { text: "Assista uma aula online", category: "ğŸ§  Mental", difficulty: "â­ MÃ©dio" },
  { text: "Escreva 500 palavras", category: "ğŸ§  Mental", difficulty: "â­â­ DifÃ­cil" },
  { text: "Resolva 10 problemas de lÃ³gica", category: "ğŸ§  Mental", difficulty: "â­â­ DifÃ­cil" },
  { text: "Leia um artigo cientÃ­fico completo", category: "ğŸ§  Mental", difficulty: "â­â­ DifÃ­cil" },
  { text: "Estude algo novo por 1 hora", category: "ğŸ§  Mental", difficulty: "â­ MÃ©dio" },
  { text: "FaÃ§a um curso online completo", category: "ğŸ§  Mental", difficulty: "â­â­â­ Muito DifÃ­cil" },
  { text: "Memorize 20 itens de uma lista", category: "ğŸ§  Mental", difficulty: "â­â­ DifÃ­cil" },
  { text: "Leia 50 pÃ¡ginas sem parar", category: "ğŸ§  Mental", difficulty: "â­â­â­ Muito DifÃ­cil" },
  
  // SAÃšDE
  { text: "Beba 3L de Ã¡gua hoje", category: "ğŸ’š SaÃºde", difficulty: "â­ MÃ©dio" },
  { text: "Zero aÃ§Ãºcar o dia todo", category: "ğŸ’š SaÃºde", difficulty: "â­â­ DifÃ­cil" },
  { text: "Coma 5 porÃ§Ãµes de vegetais", category: "ğŸ’š SaÃºde", difficulty: "â­ MÃ©dio" },
  { text: "Durma 8 horas esta noite", category: "ğŸ’š SaÃºde", difficulty: "â­ MÃ©dio" },
  { text: "Zero refrigerante/bebidas aÃ§ucaradas", category: "ğŸ’š SaÃºde", difficulty: "â­ MÃ©dio" },
  { text: "FaÃ§a todas as refeiÃ§Ãµes sem telas", category: "ğŸ’š SaÃºde", difficulty: "â­â­ DifÃ­cil" },
  { text: "Tome sol por 20 minutos", category: "ğŸ’š SaÃºde", difficulty: "FÃ¡cil" },
  { text: "Zero fast food o dia inteiro", category: "ğŸ’š SaÃºde", difficulty: "â­ MÃ©dio" },
  { text: "Coma apenas comida caseira", category: "ğŸ’š SaÃºde", difficulty: "â­â­ DifÃ­cil" },
  { text: "Prepare 3 refeiÃ§Ãµes saudÃ¡veis", category: "ğŸ’š SaÃºde", difficulty: "â­â­ DifÃ­cil" },
  
  // CRIATIVO
  { text: "Desenhe algo por 30 minutos", category: "ğŸ¨ Criativo", difficulty: "â­ MÃ©dio" },
  { text: "Pratique um instrumento por 30 min", category: "ğŸ¨ Criativo", difficulty: "â­ MÃ©dio" },
  { text: "Escreva uma histÃ³ria curta", category: "ğŸ¨ Criativo", difficulty: "â­â­ DifÃ­cil" },
  { text: "Tire 50 fotos criativas", category: "ğŸ¨ Criativo", difficulty: "â­ MÃ©dio" },
  { text: "Crie algo novo com as prÃ³prias mÃ£os", category: "ğŸ¨ Criativo", difficulty: "â­â­ DifÃ­cil" },
  { text: "Aprenda uma nova receita", category: "ğŸ¨ Criativo", difficulty: "â­ MÃ©dio" },
  { text: "FaÃ§a um projeto DIY", category: "ğŸ¨ Criativo", difficulty: "â­â­â­ Muito DifÃ­cil" },
  { text: "Componha uma mÃºsica simples", category: "ğŸ¨ Criativo", difficulty: "â­â­â­ Muito DifÃ­cil" },
  { text: "Escreva um poema", category: "ğŸ¨ Criativo", difficulty: "â­ MÃ©dio" },
  { text: "Edite um vÃ­deo criativo", category: "ğŸ¨ Criativo", difficulty: "â­â­ DifÃ­cil" },
  
  // BEM-ESTAR
  { text: "Medite por 20 minutos", category: "ğŸŒŸ Bem-estar", difficulty: "â­ MÃ©dio" },
  { text: "Fique 6 horas sem celular", category: "ğŸŒŸ Bem-estar", difficulty: "â­â­â­ Muito DifÃ­cil" },
  { text: "FaÃ§a alongamento completo", category: "ğŸŒŸ Bem-estar", difficulty: "â­ MÃ©dio" },
  { text: "Pratique gratidÃ£o - liste 10 coisas", category: "ğŸŒŸ Bem-estar", difficulty: "FÃ¡cil" },
  { text: "Organize sua mesa de trabalho", category: "ğŸŒŸ Bem-estar", difficulty: "â­ MÃ©dio" },
  { text: "Ligue para um amigo/familiar", category: "ğŸŒŸ Bem-estar", difficulty: "FÃ¡cil" },
  { text: "FaÃ§a uma boa aÃ§Ã£o para alguÃ©m", category: "ğŸŒŸ Bem-estar", difficulty: "â­ MÃ©dio" },
  { text: "Zero redes sociais o dia todo", category: "ğŸŒŸ Bem-estar", difficulty: "â­â­â­ Muito DifÃ­cil" },
  { text: "Tome um banho frio", category: "ğŸŒŸ Bem-estar", difficulty: "â­â­ DifÃ­cil" },
  { text: "Pratique respiraÃ§Ã£o profunda 10min", category: "ğŸŒŸ Bem-estar", difficulty: "â­ MÃ©dio" },
  { text: "Arrume todo seu quarto", category: "ğŸŒŸ Bem-estar", difficulty: "â­â­ DifÃ­cil" },
  { text: "Passe 1 hora na natureza", category: "ğŸŒŸ Bem-estar", difficulty: "â­ MÃ©dio" },
  { text: "Pratique yoga por 30 minutos", category: "ğŸŒŸ Bem-estar", difficulty: "â­â­ DifÃ­cil" },
  { text: "Journal - escreva seus pensamentos", category: "ğŸŒŸ Bem-estar", difficulty: "â­ MÃ©dio" },
  { text: "Acorde antes das 6h", category: "ğŸŒŸ Bem-estar", difficulty: "â­â­ DifÃ­cil" }
];

// ======================
// SISTEMA DE SONS - NOVO!
// ======================
const audioContext = typeof AudioContext !== 'undefined' ? new AudioContext() : null;
let soundEnabled = true;

// FunÃ§Ã£o para criar sons procedurais
function playSound(type) {
  if (!soundEnabled || !audioContext) return;
  
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  const now = audioContext.currentTime;
  
  switch(type) {
    case 'taskComplete':
      // Som de conclusÃ£o de tarefa - bip ascendente
      oscillator.frequency.setValueAtTime(523.25, now); // C5
      oscillator.frequency.exponentialRampToValueAtTime(659.25, now + 0.1); // E5
      gainNode.gain.setValueAtTime(0.3, now);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
      oscillator.start(now);
      oscillator.stop(now + 0.15);
      break;
      
    case 'levelUp':
      // Som de subida de nÃ­vel - fanfarra
      oscillator.type = 'triangle';
      oscillator.frequency.setValueAtTime(261.63, now); // C4
      oscillator.frequency.setValueAtTime(329.63, now + 0.1); // E4
      oscillator.frequency.setValueAtTime(392.00, now + 0.2); // G4
      oscillator.frequency.setValueAtTime(523.25, now + 0.3); // C5
      gainNode.gain.setValueAtTime(0.4, now);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
      oscillator.start(now);
      oscillator.stop(now + 0.5);
      break;
      
    case 'xpGain':
      // Som de ganho de XP - som suave
      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(440, now); // A4
      oscillator.frequency.exponentialRampToValueAtTime(880, now + 0.08);
      gainNode.gain.setValueAtTime(0.2, now);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
      oscillator.start(now);
      oscillator.stop(now + 0.1);
      break;
      
    case 'achievement':
      // Som de conquista - acorde triunfante
      oscillator.type = 'square';
      oscillator.frequency.setValueAtTime(392.00, now); // G4
      oscillator.frequency.setValueAtTime(493.88, now + 0.15); // B4
      oscillator.frequency.setValueAtTime(659.25, now + 0.3); // E5
      gainNode.gain.setValueAtTime(0.3, now);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
      oscillator.start(now);
      oscillator.stop(now + 0.5);
      break;
      
    case 'click':
      // Som de clique - bip curto
      oscillator.type = 'square';
      oscillator.frequency.setValueAtTime(800, now);
      gainNode.gain.setValueAtTime(0.1, now);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
      oscillator.start(now);
      oscillator.stop(now + 0.05);
      break;
      
    case 'water':
      // Som de Ã¡gua - frequÃªncia baixa ondulante
      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(200, now);
      oscillator.frequency.setValueAtTime(250, now + 0.05);
      oscillator.frequency.setValueAtTime(200, now + 0.1);
      gainNode.gain.setValueAtTime(0.15, now);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.12);
      oscillator.start(now);
      oscillator.stop(now + 0.12);
      break;
      
    case 'challenge':
      // Som de desafio - dramÃ¡tico
      oscillator.type = 'sawtooth';
      oscillator.frequency.setValueAtTime(220, now); // A3
      oscillator.frequency.exponentialRampToValueAtTime(440, now + 0.2); // A4
      gainNode.gain.setValueAtTime(0.25, now);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.25);
      oscillator.start(now);
      oscillator.stop(now + 0.25);
      break;
      
    case 'workout':
      // Som de treino - energia
      oscillator.type = 'square';
      oscillator.frequency.setValueAtTime(330, now); // E4
      oscillator.frequency.setValueAtTime(440, now + 0.08); // A4
      gainNode.gain.setValueAtTime(0.2, now);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
      oscillator.start(now);
      oscillator.stop(now + 0.15);
      break;
      
    case 'error':
      // Som de erro - bip baixo descendente
      oscillator.type = 'square';
      oscillator.frequency.setValueAtTime(300, now);
      oscillator.frequency.exponentialRampToValueAtTime(150, now + 0.2);
      gainNode.gain.setValueAtTime(0.2, now);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
      oscillator.start(now);
      oscillator.stop(now + 0.2);
      break;
  }
}

// FunÃ§Ã£o para alternar sons
function toggleSound() {
  soundEnabled = !soundEnabled;
  const soundBtn = document.getElementById('soundToggle');
  if (soundBtn) {
    soundBtn.innerText = soundEnabled ? 'ğŸ”Š Som: ON' : 'ğŸ”‡ Som: OFF';
  }
  localStorage.setItem('soundEnabled', soundEnabled);
  
  if (soundEnabled) {
    playSound('click');
    showNotification('ğŸ”Š Sons ativados!', 'success');
  } else {
    showNotification('ğŸ”‡ Sons desativados', 'info');
  }
}

// Carregar preferÃªncia de som
function loadSoundPreference() {
  const saved = localStorage.getItem('soundEnabled');
  if (saved !== null) {
    soundEnabled = saved === 'true';
  }
  const soundBtn = document.getElementById('soundToggle');
  if (soundBtn) {
    soundBtn.innerText = soundEnabled ? 'ğŸ”Š Som: ON' : 'ğŸ”‡ Som: OFF';
  }
}

// ======================
// FEEDBACK TÃTIL (VIBRAÃ‡ÃƒO) - NOVO!
// ======================
function vibrate(pattern) {
  if ('vibrate' in navigator) {
    navigator.vibrate(pattern);
  }
}

// PadrÃµes de vibraÃ§Ã£o
const VIBRATE_PATTERNS = {
  light: 10,
  medium: 30,
  strong: 50,
  success: [30, 50, 30],
  levelUp: [50, 100, 50, 100, 50],
  error: [100, 50, 100]
};

// ======================
// CONFETES AO SUBIR DE NÃVEL - NOVO!
// ======================
function createConfetti() {
  const colors = ['#ff6b6b', '#ffd93d', '#4ecdc4', '#a78bfa', '#f093fb'];
  const confettiCount = 50;
  
  for (let i = 0; i < confettiCount; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.animationDelay = Math.random() * 0.5 + 's';
    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
    confetti.style.animation = 'confetti-fall ' + (Math.random() * 2 + 2) + 's ease-out forwards';
    
    document.body.appendChild(confetti);
    
    setTimeout(() => confetti.remove(), 4000);
  }
}

// ======================
// NOTIFICAÃ‡Ã•ES ELEGANTES - MELHORADO!
// ======================
function showNotification(message, type = 'default') {
  const notif = document.getElementById('notification');
  if (!notif) return;
  
  // Remover classes anteriores
  notif.className = '';
  notif.classList.add('show');
  
  // Adicionar tipo
  if (type === 'success') {
    notif.classList.add('success');
    vibrate(VIBRATE_PATTERNS.success);
  } else if (type === 'warning') {
    notif.classList.add('warning');
    vibrate(VIBRATE_PATTERNS.medium);
  } else if (type === 'error') {
    notif.classList.add('error');
    vibrate(VIBRATE_PATTERNS.error);
  } else {
    vibrate(VIBRATE_PATTERNS.light);
  }
  
  notif.innerText = message;
  
  setTimeout(() => {
    notif.classList.remove('show');
  }, 3000);
}

// ======================
// PARTÃCULAS DE FUNDO
// ======================
function createParticles() {
  const particleCount = 20;
  for (let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = Math.random() * 100 + '%';
    particle.style.animationDelay = Math.random() * 20 + 's';
    document.body.appendChild(particle);
  }
}

// ======================
// NAVEGAÃ‡ÃƒO COM TRANSIÃ‡Ã•ES SUAVES - MELHORADO!
// ======================
let currentScreen = '';

function openScreen(screen) {
  // VibraÃ§Ã£o ao navegar
  vibrate(VIBRATE_PATTERNS.light);
  
  const screens = ['setup', 'menu', 'tasks', 'achievements', 'ranking', 'history', 'dailyChallenge', 'workouts', 'water'];
  
  // Fade out da tela atual
  if (currentScreen) {
    const oldScreen = document.getElementById(currentScreen);
    if (oldScreen) {
      oldScreen.classList.add('fade-out');
      setTimeout(() => {
        oldScreen.classList.add('hidden');
        oldScreen.classList.remove('fade-out');
      }, 300);
    }
  }
  
  // Fade in da nova tela
  setTimeout(() => {
    screens.forEach(s => {
      const el = document.getElementById(s);
      if (el) {
        if (s === screen) {
          el.classList.remove('hidden');
          el.classList.add('screen');
        } else {
          el.classList.add('hidden');
        }
      }
    });
    
    currentScreen = screen;
    
    // Atualizar conteÃºdo especÃ­fico
    if (screen === 'menu') updateUI();
    if (screen === 'tasks') renderTasks();
    if (screen === 'achievements') renderAchievements();
    if (screen === 'ranking') renderRanking();
    if (screen === 'history') renderHistory();
    if (screen === 'dailyChallenge') renderDailyChallenge();
    if (screen === 'workouts') renderWorkoutTracker();
    if (screen === 'water') updateWaterUI();
  }, currentScreen ? 300 : 0);
}

// ======================
// SISTEMA DE XP E NÃVEL
// ======================
function getXPForLevel(level) {
  return Math.floor(100 * Math.pow(1.5, level - 1));
}

function addXP(amount) {
  player.xp += amount;
  player.totalXP += amount;
  
  const xpNeeded = getXPForLevel(player.level);
  
  if (player.xp >= xpNeeded) {
    levelUp();
  } else {
    playSound('xpGain');
  }
  
  save();
  updateUI();
}

function levelUp() {
  player.xp -= getXPForLevel(player.level);
  player.level++;
  
  if (player.level > player.maxLevel) {
    player.maxLevel = player.level;
  }
  
  // SOM DE LEVEL UP
  playSound('levelUp');
  
  // VIBRAÃ‡ÃƒO FORTE AO SUBIR DE NÃVEL
  vibrate(VIBRATE_PATTERNS.levelUp);
  
  // CONFETES! ğŸŠ
  createConfetti();
  
  // AnimaÃ§Ã£o do player
  const playerEl = document.getElementById('player');
  if (playerEl) {
    playerEl.classList.add('player-pulse');
    setTimeout(() => playerEl.classList.remove('player-pulse'), 800);
  }
  
  // AnimaÃ§Ã£o do badge
  const badgeEl = document.getElementById('levelBadge');
  if (badgeEl) {
    badgeEl.classList.add('level-up');
    setTimeout(() => badgeEl.classList.remove('level-up'), 800);
  }
  
  updatePlayerEmoji();
  checkAchievements();
  showNotification(`ğŸ‰ LEVEL UP! Agora vocÃª Ã© Level ${player.level}!`, 'success');
  
  if (player.xp >= getXPForLevel(player.level)) {
    levelUp();
  }
}

function updatePlayerEmoji() {
  const playerEl = document.getElementById('player');
  if (!playerEl || !player.gender) return;
  
  const emojis = playerEmojis[player.gender];
  const index = Math.min(Math.floor(player.level / 2), emojis.length - 1);
  playerEl.innerText = emojis[index];
}

function updateUI() {
  const levelBadge = document.getElementById('levelBadge');
  const xpBar = document.getElementById('xpBar');
  const xpText = document.getElementById('xpText');
  const currentStreakEl = document.getElementById('currentStreak');
  const totalXPEl = document.getElementById('totalXP');
  const tasksTodayEl = document.getElementById('tasksToday');
  
  if (levelBadge) levelBadge.innerText = `Level ${player.level}`;
  
  const xpNeeded = getXPForLevel(player.level);
  const xpPercent = Math.min(100, (player.xp / xpNeeded) * 100);
  
  if (xpBar) {
    xpBar.style.width = xpPercent + '%';
  }
  
  if (xpText) xpText.innerText = `${player.xp} / ${xpNeeded} XP`;
  if (currentStreakEl) currentStreakEl.innerText = `${player.currentStreak} dias`;
  if (totalXPEl) totalXPEl.innerText = player.totalXP;
  if (tasksTodayEl) tasksTodayEl.innerText = player.tasksToday;
  
  updatePlayerEmoji();
}

// ======================
// RESET DIÃRIO
// ======================
function dailyReset() {
  const today = new Date().toDateString();
  
  if (player.lastDate !== today) {
    // HistÃ³rico do dia anterior
    if (player.lastDate) {
      const yesterday = new Date(player.lastDate);
      const todayDate = new Date(today);
      const diffDays = Math.floor((todayDate - yesterday) / (1000 * 60 * 60 * 24));
      
      if (diffDays === 1) {
        if (player.tasksToday > 0) {
          player.currentStreak++;
          if (player.currentStreak > player.bestStreak) {
            player.bestStreak = player.currentStreak;
          }
        } else {
          player.currentStreak = 0;
        }
      } else if (diffDays > 1) {
        player.currentStreak = 0;
      }
      
      // Salvar histÃ³rico
      const challengesCompleted = Array.isArray(player.dailyChallengesCompleted) 
        ? player.dailyChallengesCompleted.filter(c => c).length 
        : (player.dailyChallengeCompleted ? 1 : 0);
      
      player.history.push({
        date: player.lastDate,
        xp: player.totalXP,
        tasks: player.tasksToday,
        level: player.level,
        challengesCompleted: challengesCompleted,
        challengeCompleted: challengesCompleted > 0 // Compatibilidade
      });
      
      if (player.history.length > 90) {
        player.history.shift();
      }
      
      // HidrataÃ§Ã£o
      if (player.waterToday >= player.waterGoal) {
        player.waterDaysCompleted++;
        player.waterStreak++;
        if (player.waterStreak > player.waterBestStreak) {
          player.waterBestStreak = player.waterStreak;
        }
      } else {
        player.waterStreak = 0;
      }
      
      player.waterHistory.push({
        date: player.lastDate,
        amount: player.waterToday
      });
      
      if (player.waterHistory.length > 30) {
        player.waterHistory.shift();
      }
    } else {
      // Primeiro dia jogando - inicializar streak
      if (player.currentStreak === undefined) player.currentStreak = 0;
      if (player.bestStreak === undefined) player.bestStreak = 0;
    }
    
    player.daysPlayed++;
    player.lastDate = today;
    player.tasksToday = 0;
    player.completedToday = [];
    player.workoutCompleted = {};
    player.dailyChallengesCompleted = [false, false, false];
    player.waterToday = 0;
    
    save();
  }
}

// ======================
// CONQUISTAS
// ======================
function checkAchievements() {
  const newAchievements = [];
  
  if (!player.achievements.includes('first_task') && player.totalTasks >= 1) {
    player.achievements.push('first_task');
    newAchievements.push('ğŸ¯ Primeira Tarefa');
  }
  
  if (!player.achievements.includes('streak_7') && player.bestStreak >= 7) {
    player.achievements.push('streak_7');
    newAchievements.push('ğŸ”¥ Uma Semana');
  }
  
  if (!player.achievements.includes('streak_30') && player.bestStreak >= 30) {
    player.achievements.push('streak_30');
    newAchievements.push('ğŸ’ª Um MÃªs');
  }
  
  if (!player.achievements.includes('level_5') && player.level >= 5) {
    player.achievements.push('level_5');
    newAchievements.push('â­ NÃ­vel 5');
  }
  
  if (!player.achievements.includes('level_10') && player.level >= 10) {
    player.achievements.push('level_10');
    newAchievements.push('ğŸŒŸ NÃ­vel 10');
  }
  
  if (!player.achievements.includes('tasks_100') && player.totalTasks >= 100) {
    player.achievements.push('tasks_100');
    newAchievements.push('ğŸ’¯ CentenÃ¡rio');
  }
  
  if (!player.achievements.includes('tasks_500') && player.totalTasks >= 500) {
    player.achievements.push('tasks_500');
    newAchievements.push('ğŸ† Dedicado');
  }
  
  // Conquistas especÃ­ficas
  const earlyBirdCount = player.taskHistory['acordar_cedo'] || 0;
  if (!player.achievements.includes('early_bird') && earlyBirdCount >= 10) {
    player.achievements.push('early_bird');
    newAchievements.push('ğŸŒ… Madrugador');
  }
  
  const gymCount = player.taskHistory['exercicio'] || 0;
  if (!player.achievements.includes('gym_rat') && gymCount >= 20) {
    player.achievements.push('gym_rat');
    newAchievements.push('ğŸ’ª Fitness');
  }
  
  const readCount = player.taskHistory['leitura'] || 0;
  if (!player.achievements.includes('bookworm') && readCount >= 15) {
    player.achievements.push('bookworm');
    newAchievements.push('ğŸ“š Leitor');
  }
  
  if (!player.achievements.includes('hydrated') && player.waterDaysCompleted >= 10) {
    player.achievements.push('hydrated');
    newAchievements.push('ğŸ’§ Hidratado');
  }
  
  const meditationCount = player.taskHistory['meditacao'] || 0;
  if (!player.achievements.includes('zen_master') && meditationCount >= 15) {
    player.achievements.push('zen_master');
    newAchievements.push('ğŸ§˜ Zen Master');
  }
  
  if (newAchievements.length > 0) {
    vibrate(VIBRATE_PATTERNS.success);
    showNotification(`ğŸ† Nova Conquista: ${newAchievements.join(', ')}`, 'success');
  }
}

// ======================
// TAREFAS
// ======================
function completeTask(taskId, xp, taskName) {
  if (player.completedToday.includes(taskId)) {
    playSound('error');
    showNotification("âœ“ Tarefa jÃ¡ concluÃ­da hoje!", 'warning');
    return;
  }
  
  player.completedToday.push(taskId);
  player.tasksToday++;
  player.totalTasks++;
  
  // Streak da tarefa
  if (!player.taskStreaks[taskId]) player.taskStreaks[taskId] = 0;
  player.taskStreaks[taskId]++;
  
  // HistÃ³rico da tarefa
  if (!player.taskHistory[taskId]) player.taskHistory[taskId] = 0;
  player.taskHistory[taskId]++;
  
  // BÃ´nus de streak
  let bonus = 0;
  if (player.taskStreaks[taskId] >= 7) bonus = 10;
  if (player.taskStreaks[taskId] >= 30) bonus = 30;
  
  const totalXP = xp + bonus;
  addXP(totalXP);
  
  let message = `âœ… ${taskName} +${totalXP} XP`;
  if (bonus > 0) {
    message += ` (${player.taskStreaks[taskId]} dias de streak!)`;
  }
  
  playSound('taskComplete');
  showNotification(message, 'success');
  checkAchievements();
  save();
  renderTasks();
}

function renderTasks() {
  const div = document.getElementById("tasksList");
  if (!div) return;
  
  div.innerHTML = "";
  
  const categories = {};
  tasksList.forEach(t => {
    if (!categories[t.category]) categories[t.category] = [];
    categories[t.category].push(t);
  });
  
  Object.keys(categories).forEach(cat => {
    const section = document.createElement("div");
    section.className = "section";
    
    const h3 = document.createElement("h3");
    h3.innerText = cat;
    section.appendChild(h3);
    
    categories[cat].forEach(t => {
      const btn = document.createElement("button");
      
      if (player.completedToday.includes(t.id)) {
        btn.classList.add("completed");
        btn.innerText = `${t.name} âœ“`;
        btn.disabled = true;
      } else {
        btn.onclick = () => completeTask(t.id, t.xp, t.name);
        btn.innerText = `${t.name} (+${t.xp} XP)`;
      }
      
      section.appendChild(btn);
    });
    
    div.appendChild(section);
  });
}

// ======================
// CONQUISTAS
// ======================
function renderAchievements() {
  const div = document.getElementById("achievementsList");
  if (!div) return;
  
  div.innerHTML = "";
  
  achievementsList.forEach(ach => {
    const unlocked = player.achievements.includes(ach.id);
    const badge = document.createElement("div");
    badge.className = unlocked ? "badge" : "badge locked";
    badge.innerHTML = `
      <div style="font-size: 32px; margin-bottom: 5px;">${ach.icon}</div>
      <strong>${ach.name}</strong><br>
      <small style="opacity: 0.8;">${ach.desc}</small>
    `;
    div.appendChild(badge);
  });
}

// ======================
// RANKING
// ======================
function renderRanking() {
  const totalXPRankEl = document.getElementById("totalXPRank");
  const bestStreakEl = document.getElementById("bestStreakDisplay");
  const totalTasksEl = document.getElementById("totalTasksDisplay");
  const daysPlayedEl = document.getElementById("daysPlayedDisplay");
  const maxLevelEl = document.getElementById("maxLevelDisplay");
  
  if (totalXPRankEl) totalXPRankEl.innerText = player.totalXP;
  if (bestStreakEl) bestStreakEl.innerText = `${player.bestStreak} dias`;
  if (totalTasksEl) totalTasksEl.innerText = player.totalTasks;
  if (daysPlayedEl) daysPlayedEl.innerText = player.daysPlayed;
  if (maxLevelEl) maxLevelEl.innerText = player.maxLevel;
}

// ======================
// DESAFIO DIÃRIO
// ======================
function getDailyChallenges() {
  const today = new Date();
  const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
  
  // Gerar 3 desafios diferentes baseados no dia
  const challenges = [];
  const usedIndices = new Set();
  
  for (let i = 0; i < 3; i++) {
    let index = (dayOfYear + i * 17) % dailyChallenges.length; // Multiplicador para garantir variedade
    
    // Garantir que nÃ£o repetimos desafios
    while (usedIndices.has(index)) {
      index = (index + 1) % dailyChallenges.length;
    }
    
    usedIndices.add(index);
    challenges.push(dailyChallenges[index]);
  }
  
  return challenges;
}

function renderDailyChallenge() {
  const challenges = getDailyChallenges();
  
  // Garantir compatibilidade com dados antigos
  if (!Array.isArray(player.dailyChallengesCompleted)) {
    player.dailyChallengesCompleted = [false, false, false];
  }
  
  // Renderizar cada desafio
  for (let i = 0; i < 3; i++) {
    const challenge = challenges[i];
    const num = i + 1;
    
    const descEl = document.getElementById(`challenge${num}Description`);
    const categoryEl = document.getElementById(`challenge${num}Category`);
    const difficultyEl = document.getElementById(`challenge${num}Difficulty`);
    const btnEl = document.getElementById(`challenge${num}Btn`);
    
    if (descEl) descEl.innerText = challenge.text;
    if (categoryEl) categoryEl.innerText = challenge.category;
    if (difficultyEl) difficultyEl.innerText = challenge.difficulty;
    
    if (btnEl) {
      if (player.dailyChallengesCompleted[i]) {
        btnEl.innerText = "Completado âœ“";
        btnEl.disabled = true;
        btnEl.classList.add("completed");
      } else {
        btnEl.innerText = "Completar (+100 XP)";
        btnEl.disabled = false;
        btnEl.classList.remove("completed");
      }
    }
  }
  
  // Contador de desafios hoje
  const completedToday = player.dailyChallengesCompleted.filter(c => c).length;
  const todayCountEl = document.getElementById('todayChallengesCount');
  if (todayCountEl) todayCountEl.innerText = `${completedToday}/3`;
  
  // EstatÃ­sticas de desafios (agora conta todos os desafios, nÃ£o apenas dias)
  let totalChallengesCompleted = 0;
  player.history.forEach(h => {
    if (h.challengesCompleted) {
      totalChallengesCompleted += h.challengesCompleted;
    } else if (h.challengeCompleted) {
      // Compatibilidade com dados antigos
      totalChallengesCompleted += 1;
    }
  });
  
  const totalChallengesEl = document.getElementById('totalChallenges');
  if (totalChallengesEl) totalChallengesEl.innerText = totalChallengesCompleted;
  
  // Streak atual de desafios (dias com pelo menos 1 desafio completo)
  let currentChallengeStreak = 0;
  for (let i = player.history.length - 1; i >= 0; i--) {
    const day = player.history[i];
    if ((day.challengesCompleted && day.challengesCompleted > 0) || day.challengeCompleted) {
      currentChallengeStreak++;
    } else {
      break;
    }
  }
  const currentChallengeStreakEl = document.getElementById('currentChallengeStreak');
  if (currentChallengeStreakEl) currentChallengeStreakEl.innerText = `${currentChallengeStreak} dias`;
  
  // Melhor streak de desafios
  let maxStreak = 0;
  let currentStreak = 0;
  player.history.forEach(h => {
    if ((h.challengesCompleted && h.challengesCompleted > 0) || h.challengeCompleted) {
      currentStreak++;
      if (currentStreak > maxStreak) maxStreak = currentStreak;
    } else {
      currentStreak = 0;
    }
  });
  const challengeStreakEl = document.getElementById('challengeStreak');
  if (challengeStreakEl) challengeStreakEl.innerText = `${maxStreak} dias`;
  
  // Taxa de conclusÃ£o (mÃ©dia de desafios por dia)
  const totalDays = player.daysPlayed > 0 ? player.daysPlayed : 1;
  const completionRate = Math.round((totalChallengesCompleted / (totalDays * 3)) * 100);
  const completionRateEl = document.getElementById('challengeCompletionRate');
  if (completionRateEl) completionRateEl.innerText = `${completionRate}%`;
  
  // EstatÃ­sticas por categoria
  if (!player.challengesByCategory) {
    player.challengesByCategory = {
      fitness: 0,
      mental: 0,
      health: 0,
      creative: 0,
      wellness: 0
    };
  }
  
  const fitnessEl = document.getElementById('challengesFitness');
  const mentalEl = document.getElementById('challengesMental');
  const healthEl = document.getElementById('challengesHealth');
  const creativeEl = document.getElementById('challengesCreative');
  const wellnessEl = document.getElementById('challengesWellness');
  
  if (fitnessEl) fitnessEl.innerText = player.challengesByCategory.fitness || 0;
  if (mentalEl) mentalEl.innerText = player.challengesByCategory.mental || 0;
  if (healthEl) healthEl.innerText = player.challengesByCategory.health || 0;
  if (creativeEl) creativeEl.innerText = player.challengesByCategory.creative || 0;
  if (wellnessEl) wellnessEl.innerText = player.challengesByCategory.wellness || 0;
}

function completeDailyChallenge(challengeIndex) {
  // Garantir compatibilidade
  if (!Array.isArray(player.dailyChallengesCompleted)) {
    player.dailyChallengesCompleted = [false, false, false];
  }
  
  if (player.dailyChallengesCompleted[challengeIndex]) {
    showNotification("âœ“ Desafio jÃ¡ concluÃ­do hoje!", 'warning');
    return;
  }
  
  const challenges = getDailyChallenges();
  const challenge = challenges[challengeIndex];
  
  // Inicializar categorias se nÃ£o existir
  if (!player.challengesByCategory) {
    player.challengesByCategory = {
      fitness: 0,
      mental: 0,
      health: 0,
      creative: 0,
      wellness: 0
    };
  }
  
  // Registrar categoria
  const categoryMap = {
    "ğŸ‹ï¸ Fitness": "fitness",
    "ğŸ§  Mental": "mental",
    "ğŸ’š SaÃºde": "health",
    "ğŸ¨ Criativo": "creative",
    "ğŸŒŸ Bem-estar": "wellness"
  };
  
  const categoryKey = categoryMap[challenge.category];
  if (categoryKey && player.challengesByCategory[categoryKey] !== undefined) {
    player.challengesByCategory[categoryKey]++;
  }
  
  player.dailyChallengesCompleted[challengeIndex] = true;
  addXP(100);
  playSound('challenge');
  vibrate(VIBRATE_PATTERNS.success);
  showNotification("ğŸ² Desafio ConcluÃ­do! +100 XP", 'success');
  save();
  renderDailyChallenge();
}

// ======================
// TREINOS
// ======================
function renderWorkoutTracker() {
  const workouts = ['morning', 'afternoon', 'evening', 'cardio', 'strength', 'bodyweight', 'yoga', 'sports', 'stretching', 'swimming'];
  let completedCount = 0;
  
  workouts.forEach(type => {
    const itemEl = document.getElementById(`workout-${type}`);
    if (itemEl) {
      if (player.workoutCompleted[type]) {
        itemEl.classList.add('completed');
        completedCount++;
      } else {
        itemEl.classList.remove('completed');
      }
    }
  });
  
  const todayEl = document.getElementById('workoutsToday');
  if (todayEl) todayEl.innerText = `${completedCount}/10`;
  
  // Calcular total de treinos
  if (!player.totalWorkouts) player.totalWorkouts = 0;
  const totalWorkoutsEl = document.getElementById('totalWorkouts');
  if (totalWorkoutsEl) totalWorkoutsEl.innerText = player.totalWorkouts;
  
  // Calcular streak de treinos
  let workoutStreak = 0;
  for (let i = player.history.length - 1; i >= 0; i--) {
    const dayData = player.history[i];
    if (dayData && dayData.tasks > 0) {
      workoutStreak++;
    } else {
      break;
    }
  }
  
  const streakEl = document.getElementById('workoutStreak');
  if (streakEl) streakEl.innerText = `${workoutStreak} dias`;
}

function toggleWorkout(type) {
  if (player.workoutCompleted[type]) {
    playSound('error');
    showNotification("âœ“ Treino jÃ¡ registrado!", 'warning');
    return;
  }
  
  // XP baseado no tipo de treino
  const xpValues = {
    'morning': 30,
    'afternoon': 30,
    'evening': 30,
    'cardio': 35,
    'strength': 40,
    'bodyweight': 35,
    'yoga': 30,
    'sports': 35,
    'stretching': 20,
    'swimming': 40
  };
  
  const xp = xpValues[type] || 30;
  
  player.workoutCompleted[type] = true;
  
  // Incrementar total de treinos
  if (!player.totalWorkouts) player.totalWorkouts = 0;
  player.totalWorkouts++;
  
  addXP(xp);
  playSound('workout');
  vibrate(VIBRATE_PATTERNS.medium);
  showNotification(`ğŸ’ª Treino registrado! +${xp} XP`, 'success');
  save();
  renderWorkoutTracker();
}

// ======================
// HIDRATAÃ‡ÃƒO COM PROGRESS BAR ANIMADA - NOVO!
// ======================
function updateWaterUI() {
  const waterTodayEl = document.getElementById('waterToday');
  const waterGoalEl = document.getElementById('waterGoalDisplay');
  const waterProgressEl = document.getElementById('waterProgress');
  const waterStreakEl = document.getElementById('waterStreakDisplay');
  const waterBestStreakEl = document.getElementById('waterBestStreakDisplay');
  const waterDaysEl = document.getElementById('waterDaysDisplay');
  const waterTotalEl = document.getElementById('waterTotalDisplay');
  const waterGoalInput = document.getElementById('waterGoalInput');
  
  if (waterTodayEl) waterTodayEl.innerText = player.waterToday;
  if (waterGoalEl) waterGoalEl.innerText = player.waterGoal;
  
  const progress = Math.min(100, Math.round((player.waterToday / player.waterGoal) * 100));
  if (waterProgressEl) waterProgressEl.innerText = `${progress}%`;
  
  // PROGRESS BAR ANIMADA
  const progressBar = document.getElementById('waterProgressBar');
  const progressText = document.getElementById('waterProgressText');
  if (progressBar) {
    progressBar.style.width = progress + '%';
  }
  if (progressText) {
    progressText.innerText = `${progress}%`;
  }
  
  if (waterStreakEl) waterStreakEl.innerText = `${player.waterStreak} dias`;
  if (waterBestStreakEl) waterBestStreakEl.innerText = `${player.waterBestStreak} dias`;
  if (waterDaysEl) waterDaysEl.innerText = player.waterDaysCompleted;
  
  const totalLiters = (player.waterTotalDrunk / 1000).toFixed(1);
  if (waterTotalEl) waterTotalEl.innerText = `${totalLiters} L`;
  
  if (waterGoalInput) waterGoalInput.value = player.waterGoal;
}

function addWater(amount) {
  player.waterToday += amount;
  player.waterTotalDrunk += amount;
  
  if (player.waterToday >= player.waterGoal) {
    const firstTime = player.waterToday - amount < player.waterGoal;
    if (firstTime) {
      addXP(50);
      playSound('achievement');
      vibrate(VIBRATE_PATTERNS.success);
      showNotification("ğŸ’§ Meta de hidrataÃ§Ã£o atingida! +50 XP", 'success');
    } else {
      playSound('water');
      vibrate(VIBRATE_PATTERNS.light);
      showNotification(`ğŸ’§ +${amount}ml adicionados!`);
    }
  } else {
    playSound('water');
    vibrate(VIBRATE_PATTERNS.light);
    showNotification(`ğŸ’§ +${amount}ml adicionados!`);
  }
  
  save();
  updateWaterUI();
}

function updateWaterGoal() {
  const input = document.getElementById('waterGoalInput');
  if (!input) return;
  
  const newGoal = parseInt(input.value);
  if (newGoal >= 500 && newGoal <= 5000) {
    player.waterGoal = newGoal;
    save();
    updateWaterUI();
    vibrate(VIBRATE_PATTERNS.light);
    showNotification("âš™ï¸ Meta de hidrataÃ§Ã£o atualizada!", 'success');
  } else {
    vibrate(VIBRATE_PATTERNS.error);
    showNotification("âŒ Meta deve estar entre 500ml e 5000ml", 'error');
  }
}

// ======================
// HISTÃ“RICO
// ======================
function renderHistory() {
  const grid = document.getElementById('historyGrid');
  if (!grid) return;
  
  grid.innerHTML = '';
  
  const last30Days = player.history.slice(-30);
  
  if (last30Days.length === 0) {
    grid.innerHTML = '<p style="text-align: center; opacity: 0.6; padding: 40px;">Nenhum histÃ³rico ainda. Comece a completar tarefas!</p>';
    return;
  }
  
  last30Days.forEach(day => {
    const dayEl = document.createElement('div');
    dayEl.className = day.tasks > 0 ? 'history-day active' : 'history-day';
    
    const date = new Date(day.date);
    const dateStr = `${date.getDate()}/${date.getMonth() + 1}`;
    
    dayEl.innerHTML = `
      <div class="history-date">${dateStr}</div>
      <div class="history-xp">${day.xp} XP</div>
      <div class="history-tasks">${day.tasks} tarefas</div>
    `;
    
    grid.appendChild(dayEl);
  });
}

// ======================
// SETUP
// ======================
function selectGender(gender) {
  player.gender = gender;
  vibrate(VIBRATE_PATTERNS.medium);
  save();
  openScreen('menu');
  updateUI();
}

function resetProgress() {
  if (confirm("Tem certeza que deseja resetar todo o progresso? Esta aÃ§Ã£o nÃ£o pode ser desfeita!")) {
    try {
      vibrate(VIBRATE_PATTERNS.strong);
      localStorage.removeItem("disciplinaRPG_v9");
      localStorage.removeItem("disciplinaRPG_v8");
      localStorage.removeItem("disciplinaRPG_v7");
      location.reload();
    } catch (e) {
      showNotification("Erro ao resetar. Tente novamente.", 'error');
    }
  }
}

// ======================
// SAVE / LOAD
// ======================
function save() {
  try {
    localStorage.setItem("disciplinaRPG_v9", JSON.stringify(player));
  } catch (e) {
    console.error("Erro ao salvar:", e);
    showNotification("âš ï¸ Erro ao salvar progresso", 'error');
  }
}

function load() {
  try {
    let data = localStorage.getItem("disciplinaRPG_v9");
    
    if (!data) {
      data = localStorage.getItem("disciplinaRPG_v8");
    }
    if (!data) {
      data = localStorage.getItem("disciplinaRPG_v7");
    }
    
    if (data) {
      player = JSON.parse(data);
      
      // Garantir retrocompatibilidade
      if (!player.taskStreaks) player.taskStreaks = {};
      if (!player.taskHistory) player.taskHistory = {};
      if (!player.workoutCompleted) player.workoutCompleted = {};
      if (player.totalWorkouts === undefined) player.totalWorkouts = 0;
      
      // Migrar de dailyChallengeCompleted para dailyChallengesCompleted
      if (!Array.isArray(player.dailyChallengesCompleted)) {
        player.dailyChallengesCompleted = [false, false, false];
      }
      
      if (player.currentStreak === undefined) player.currentStreak = 0;
      if (player.bestStreak === undefined) player.bestStreak = 0;
      if (!player.challengesByCategory) {
        player.challengesByCategory = {
          fitness: 0,
          mental: 0,
          health: 0,
          creative: 0,
          wellness: 0
        };
      }
      
      if (player.waterToday === undefined) player.waterToday = 0;
      if (player.waterGoal === undefined) player.waterGoal = 2400;
      if (player.waterStreak === undefined) player.waterStreak = 0;
      if (player.waterBestStreak === undefined) player.waterBestStreak = 0;
      if (player.waterDaysCompleted === undefined) player.waterDaysCompleted = 0;
      if (player.waterTotalDrunk === undefined) player.waterTotalDrunk = 0;
      if (!player.waterHistory) player.waterHistory = [];
      
      if (player.history && player.history.length > 0) {
        player.history = player.history.map(day => {
          if (day.challengeCompleted === undefined) {
            day.challengeCompleted = false;
          }
          return day;
        });
      }
    }
  } catch (e) {
    console.error("Erro ao carregar:", e);
    showNotification("âš ï¸ Erro ao carregar progresso", 'error');
  }
  
  dailyReset();
  
  if (!player.gender) {
    openScreen('setup');
  } else {
    openScreen('menu');
  }
}

// ======================
// INICIALIZAR
// ======================
try {
  createParticles();
  load();
  loadSoundPreference();
} catch (e) {
  console.error("Erro ao inicializar:", e);
  document.body.innerHTML = `
    <div style="text-align: center; padding: 40px; color: white;">
      <h1>âš ï¸ Erro ao Carregar</h1>
      <p>Ocorreu um erro ao inicializar o aplicativo.</p>
      <button onclick="location.reload()" style="margin-top: 20px; padding: 15px 30px; font-size: 16px; background: #667eea; color: white; border: none; border-radius: 10px; cursor: pointer;">
        Tentar Novamente
      </button>
    </div>
  `;
}

// Registrar Service Worker para PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(registration => {
        console.log('Service Worker registrado com sucesso:', registration.scope);
      })
      .catch(error => {
        console.log('Falha ao registrar Service Worker:', error);
      });
  });
}
</script>

</body>
</html>
